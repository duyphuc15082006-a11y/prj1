<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard</title>
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
  <header>
    <div class="brand">Vocab Levels</div>
    <nav>
      <span>Xin chào, <strong data-auth-status>Guest</strong></span>
      <a href="/index.html">Học từ mới</a>
      <a href="/quiz.html">Làm quiz</a>
      <a href="/leaderboard.html">Leaderboard</a>
      <a href="/admin.html" data-admin-link style="display:none">Admin</a>
      <a href="/login.html" data-login-link>Login</a>
      <a href="/register.html" data-register-link>Register</a>
      <button class="btn secondary" data-logout style="display:none">Logout</button>
    </nav>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Leaderboard</h1>
      <p>Tổng điểm quiz theo level hoặc toàn bộ.</p>
    </section>

    <div style="margin-bottom:12px;">
      <select id="level-select">
        <option value="">All levels</option>
        <option value="A1">A1</option>
        <option value="A2">A2</option>
        <option value="B1">B1</option>
        <option value="B2">B2</option>
        <option value="C1">C1</option>
      </select>
      <button class="btn" id="btn-load">Tải</button>
    </div>

    <table class="table" id="board-table">
      <thead>
        <tr>
          <th>Hạng</th>
          <th>Username</th>
          <th>Tổng điểm</th>
          <th>Lượt làm</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script src="/js/app.js"></script>
  <script>
    if (!App.requireAuth()) {
      throw new Error('Auth required');
    }
    App.renderHeader();
    const btnLoad = document.getElementById('btn-load');
    const levelSelect = document.getElementById('level-select');
    const body = document.querySelector('#board-table tbody');

    async function loadBoard() {
      const level = levelSelect.value;
      try {
        const data = await App.apiFetch(`/leaderboard?level=${level}&page=1&pageSize=20`, {
          headers: App.authHeaders()
        });
        body.innerHTML = data.items.map((row, idx) => `
          <tr>
            <td>${idx + 1}</td>
            <td>${row.username}</td>
            <td><span class="badge">${row.total_score}</span></td>
            <td>${row.attempts}</td>
          </tr>
        `).join('');
      } catch (err) {
        body.innerHTML = `<tr><td colspan="4">${err.message}</td></tr>`;
      }
    }

    btnLoad.addEventListener('click', loadBoard);
    loadBoard();
  </script>
</body>
</html>
